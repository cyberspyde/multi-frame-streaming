"use strict";exports.id=84,exports.ids=[84],exports.modules={86084:(a,b,c)=>{c.r(b),c.d(b,{BIN_DIR:()=>G,YtDlp:()=>H,helpers:()=>I});var d,e,f=c(79551),g=c(33873),h=c(79646),i=c(29021),j=c(79428),k=c(27910),l=c(55591),m=c(81630),n=g.dirname((0,f.fileURLToPath)("file:///O:/projects/multi-frame-streaming/node_modules/ytdlp-nodejs/dist/index.mjs"));function o(a){let b=[];if(a.printHelp&&b.push("--help"),a.printVersion&&b.push("--version"),a.update&&b.push("--update"),a.noUpdate&&b.push("--no-update"),a.updateTo&&b.push("--update-to",a.updateTo),a.ignoreErrors&&b.push("--ignore-errors"),a.noAbortOnError&&b.push("--no-abort-on-error"),a.abortOnError&&b.push("--abort-on-error"),a.dumpUserAgent&&b.push("--dump-user-agent"),a.listExtractors&&b.push("--list-extractors"),a.extractorDescriptions&&b.push("--extractor-descriptions"),a.useExtractors&&a.useExtractors.length>0&&b.push("--use-extractors",a.useExtractors.join(",")),a.defaultSearch&&b.push("--default-search",a.defaultSearch),a.ignoreConfig&&b.push("--ignore-config"),a.noConfigLocations&&b.push("--no-config-location"),a.configLocations&&a.configLocations.length>0&&b.push("--config-locations",...a.configLocations),a.pluginDirs&&a.pluginDirs.length>0)for(let c of a.pluginDirs)b.push("--plugin-dirs",c);if(a.noPluginDirs&&b.push("--no-plugin-dirs"),a.flatPlaylist&&b.push("--flat-playlist"),a.noFlatPlaylist&&b.push("--no-flat-playlist"),a.liveFromStart&&b.push("--live-from-start"),a.noLiveFromStart&&b.push("--no-live-from-start"),a.waitForVideo&&b.push("--wait-for-video",a.waitForVideo.toString()),a.noWaitForVideo&&b.push("--no-wait-for-video"),a.markWatched&&b.push("--mark-watched"),a.noMarkWatched&&b.push("--no-mark-watched"),a.color&&b.push("--color",a.color),a.compatOptions&&a.compatOptions.length>0&&b.push("--compat-options",a.compatOptions.join(",")),a.aliases&&a.aliases.length>0&&b.push("--alias",...a.aliases),a.proxy&&b.push("--proxy",a.proxy),a.socketTimeout&&b.push("--socket-timeout",a.socketTimeout.toString()),a.sourceAddress&&b.push("--source-address",a.sourceAddress),a.impersonate&&a.impersonate.length>0&&b.push("--impersonate",a.impersonate.join(",")),a.listImpersonateTargets&&b.push("--list-impersonate-targets"),a.forceIpv4&&b.push("--force-ipv4"),a.forceIpv6&&b.push("--force-ipv6"),a.enableFileUrls&&b.push("--enable-file-urls"),a.geoVerificationProxy&&b.push("--geo-verification-proxy",a.geoVerificationProxy),a.xff&&b.push("--xff",a.xff),a.playlistItems&&b.push("--playlist-items",a.playlistItems),a.minFilesize&&b.push("--min-filesize",a.minFilesize),a.maxFilesize&&b.push("--max-filesize",a.maxFilesize),a.date&&b.push("--date",a.date),a.dateBefore&&b.push("--datebefore",a.dateBefore),a.dateAfter&&b.push("--dateafter",a.dateAfter),a.matchFilter&&b.push("--match-filter",a.matchFilter),a.noMatchFilters&&b.push("--no-match-filters"),a.breakMatchFilters&&b.push("--break-match-filters",a.breakMatchFilters),a.noBreakMatchFilters&&b.push("--no-break-match-filters"),a.noPlaylist&&b.push("--no-playlist"),a.yesPlaylist&&b.push("--yes-playlist"),a.ageLimit&&b.push("--age-limit",a.ageLimit.toString()),a.downloadArchive&&b.push("--download-archive",a.downloadArchive),a.noDownloadArchive&&b.push("--no-download-archive"),a.maxDownloads&&b.push("--max-downloads",a.maxDownloads.toString()),a.breakOnExisting&&b.push("--break-on-existing"),a.noBreakOnExisting&&b.push("--no-break-on-existing"),a.breakPerInput&&b.push("--break-per-input"),a.noBreakPerInput&&b.push("--break-per-input"),a.skipPlaylistAfterErrors&&b.push("--skip-playlist-after-errors",a.skipPlaylistAfterErrors.toString()),a.concurrentFragments&&b.push("--concurrent-fragments",a.concurrentFragments.toString()),a.limitRate&&b.push("--limit-rate",a.limitRate),a.throttledRate&&b.push("--throttled-rate",a.throttledRate),a.retries&&b.push("--retries",a.retries.toString()),a.fileAccessRetries&&b.push("--file-access-retries",a.fileAccessRetries.toString()),a.fragmentRetries&&b.push("--fragment-retries",a.fragmentRetries.toString()),a.retrySleep&&b.push("--retry-sleep",a.retrySleep.toString()),a.skipUnavailableFragments&&b.push("--skip-unavailable-fragments"),a.abortOnUnavailableFragment&&b.push("--abort-on-unavailable-fragment"),a.keepFragments&&b.push("--keep-fragments"),a.noKeepFragments&&b.push("--no-keep-fragments"),a.bufferSize&&b.push("--buffer-size",a.bufferSize),a.resizeBuffer&&b.push("--resize-buffer"),a.noResizeBuffer&&b.push("--no-resize-buffer"),a.httpChunkSize&&b.push("--http-chunk-size",a.httpChunkSize),a.playlistRandom&&b.push("--playlist-random"),a.lazyPlaylist&&b.push("--lazy-playlist"),a.noLazyPlaylist&&b.push("--no-lazy-playlist"),a.xattrSetFilesize&&b.push("--xattr-set-filesize"),a.hlsUseMpegts&&b.push("--hls-use-mpegts"),a.noHlsUseMpegts&&b.push("--no-hls-use-mpegts"),a.downloadSections&&b.push("--download-sections",a.downloadSections.toString()),a.downloader&&b.push("--downloader",a.downloader),a.downloaderArgs&&b.push("--downloader-args",a.downloaderArgs),a.batchFile&&b.push("--batch-file",a.batchFile),a.noBatchFile&&b.push("--no-batch-file"),a.paths)if("string"==typeof a.paths)b.push("--paths",a.paths);else for(let[c,d]of Object.entries(a.paths))b.push("--paths",`${c}:${d}`);if(a.output&&b.push("-o",a.output),a.outputNaPlaceholder&&b.push("--output-na-placeholder",a.outputNaPlaceholder),a.restrictFilenames&&b.push("--restrict-filenames"),a.noRestrictFilenames&&b.push("--no-restrict-filenames"),a.windowsFilenames&&b.push("--windows-filenames"),a.noWindowsFilenames&&b.push("--no-windows-filenames"),a.trimFileNames&&b.push("--trim-file-names",a.trimFileNames.toString()),a.noOverwrites&&b.push("--no-overwrites"),a.forceOverwrites&&b.push("--force-overwrites"),a.noForceOverwrites&&b.push("--no-force-overwrites"),a.continue&&b.push("--continue"),a.noContinue&&b.push("--no-continue"),a.part&&b.push("--part"),a.noPart&&b.push("--no-part"),a.mtime&&b.push("--mtime"),a.noMtime&&b.push("--no-mtime"),a.writeDescription&&b.push("--write-description"),a.noWriteDescription&&b.push("--no-write-description"),a.writeInfoJson&&b.push("--write-info-json"),a.noWriteInfoJson&&b.push("--no-write-info-json"),a.writePlaylistMetafiles&&b.push("--write-playlist-metafiles"),a.noWritePlaylistMetafiles&&b.push("--no-write-playlist-metafiles"),a.cleanInfoJson&&b.push("--clean-info-json"),a.noCleanInfoJson&&b.push("--no-clean-info-json"),a.writeComments&&b.push("--write-comments"),a.noWriteComments&&b.push("--no-write-comments"),a.loadInfoJson&&b.push("--load-info-json",a.loadInfoJson.toString()),a.cookies&&b.push("--cookies",a.cookies),a.noCookies&&b.push("--no-cookies"),a.cookiesFromBrowser&&b.push("--cookies-from-browser",a.cookiesFromBrowser),a.noCookiesFromBrowser&&b.push("--no-cookies-from-browser"),a.cacheDir&&b.push("--cache-dir",a.cacheDir),a.noCacheDir&&b.push("--no-cache-dir"),a.rmCacheDir&&b.push("--rm-cache-dir"),a.writeThumbnail&&b.push("--write-thumbnail"),a.noWriteThumbnails&&b.push("--no-write-thumbnails"),a.writeAllThumbnails&&b.push("--write-all-thumbnails"),a.listThumbnails&&b.push("--list-thumbnails"),a.writeLink&&b.push("--write-link"),a.writeUrlLink&&b.push("--write-url-link"),a.writeWeblocLink&&b.push("--write-webloc-link"),a.writeDesktopLink&&b.push("--write-desktop-link"),a.quiet&&b.push("--quiet"),a.noQuiet&&b.push("--no-quiet"),a.noWarnings&&b.push("--no-warnings"),a.simulate&&b.push("--simulate"),a.noSimulate&&b.push("--no-simulate"),a.ignoreNoFormatsError&&b.push("--ignore-no-formats-error"),a.noIgnoreNoFormatsError&&b.push("--no-ignore-no-formats-error"),a.skipDownload&&b.push("--skip-download"),a.print&&b.push("--print",a.print),a.printToFile&&b.push("--print-to-file",a.printToFile),a.dumpJson&&b.push("--dump-json"),a.dumpSingleJson&&b.push("--dump-single-json"),a.forceWriteArchive&&b.push("--force-write-archive"),a.newline&&b.push("--newline"),a.noProgress&&b.push("--no-progress"),a.progress&&b.push("--progress"),a.consoleTitle&&b.push("--console-title"),a.progressTemplate&&b.push("--progress-template",a.progressTemplate),a.progressDelta&&b.push("--progress-delta",a.progressDelta.toString()),a.verbose&&b.push("--verbose"),a.dumpPages&&b.push("--dump-pages"),a.writePages&&b.push("--write-pages"),a.printTraffic&&b.push("--print-traffic"),a.encoding&&b.push("--encoding",a.encoding),a.legacyServerConnect&&b.push("--legacy-server-connect"),a.noCheckCertificates&&b.push("--no-check-certificates"),a.preferInsecure&&b.push("--prefer-insecure"),a.addHeaders)for(let[c,d]of Object.entries(a.addHeaders))b.push("--add-headers",`${c}:${d}`);if(a.bidiWorkaround&&b.push("--bidi-workaround"),a.sleepRequests&&b.push("--sleep-requests",a.sleepRequests.toString()),a.sleepInterval&&b.push("--sleep-interval",a.sleepInterval.toString()),a.maxSleepInterval&&b.push("--max-sleep-interval",a.maxSleepInterval.toString()),a.sleepSubtitles&&b.push("--sleep-subtitles",a.sleepSubtitles.toString()),a.format&&b.push("-f",a.format),a.formatSort&&a.formatSort.length>0&&b.push("--format-sort",a.formatSort.join(",")),a.formatSortForce&&b.push("--format-sort-force"),a.noFormatSortForce&&b.push("--no-format-sort-force"),a.videoMultiStreams&&b.push("--video-multistreams"),a.noVideoMultiStreams&&b.push("--no-video-multistreams"),a.audioMultiStreams&&b.push("--audio-multistreams"),a.noAudioMultiStreams&&b.push("--no-audio-multistreams"),a.preferFreeFormats&&b.push("--prefer-free-formats"),a.noPreferFreeFormats&&b.push("--no-prefer-free-formats"),a.checkFormats&&b.push("--check-formats"),a.checkAllFormats&&b.push("--check-all-formats"),a.noCheckFormats&&b.push("--no-check-formats"),a.listFormats&&b.push("--list-formats"),a.mergeOutputFormat&&b.push("--merge-output-format",a.mergeOutputFormat),a.writeSubs&&b.push("--write-subs"),a.noWriteSubs&&b.push("--no-write-subs"),a.writeAutoSubs&&b.push("--write-auto-subs"),a.writeAllSubs&&b.push("--all-subs"),a.listSubs&&b.push("--list-subs"),a.subFormat&&b.push("--sub-format",a.subFormat),a.subLangs&&a.subLangs.length>0&&b.push("--sub-langs",a.subLangs.join(",")),a.username&&b.push("--username",a.username),a.password&&b.push("--password",a.password),a.twoFactor&&b.push("--twofactor",a.twoFactor),a.netrc&&b.push("--netrc"),a.videoPassword&&b.push("--video-password",a.videoPassword),a.apMso&&b.push("--ap-mso",a.apMso),a.apUsername&&b.push("--ap-username",a.apUsername),a.apPassword&&b.push("--ap-password",a.apPassword),a.netrcLocation&&b.push("--netrc-location",a.netrcLocation),a.netrcCmd&&b.push("--netrc-cmd",a.netrcCmd),a.apListMso&&b.push("--ap-list-mso"),a.clientCertificate&&b.push("--client-certificate",a.clientCertificate),a.clientCertificateKey&&b.push("--client-certificate-key",a.clientCertificateKey),a.clientCertificatePassword&&b.push("--client-certificate-password",a.clientCertificatePassword),void 0!==a.extractorRetries&&b.push("--extractor-retries",a.extractorRetries.toString()),a.allowDynamicMpd&&b.push("--allow-dynamic-mpd"),a.ignoreDynamicMpd&&b.push("--ignore-dynamic-mpd"),a.hlsSplitDiscontinuity&&b.push("--hls-split-discontinuity"),a.noHlsSplitDiscontinuity&&b.push("--no-hls-split-discontinuity"),a.extractorArgs)for(let[c,d]of Object.entries(a.extractorArgs))b.push("--extractor-args",`${c}:${d.join(" ")}`);if(void 0!==a.playlistStart&&b.push("--playlist-start",a.playlistStart.toString()),void 0!==a.playlistEnd&&b.push("--playlist-end",a.playlistEnd.toString()),a.matchTitle&&b.push("--match-title",a.matchTitle),a.rejectTitle&&b.push("--reject-title",a.rejectTitle),a.includeAds&&b.push("--include-ads"),a.breakOnReject&&b.push("--break-on-reject"),a.noDownload&&b.push("--no-download"),a.playlistReverse&&b.push("--playlist-reverse"),a.geoBypass&&b.push("--geo-bypass"),a.geoBypassCountry&&b.push("--geo-bypass-country",a.geoBypassCountry),a.geoBypassIpBlock&&b.push("--geo-bypass-ip-block",a.geoBypassIpBlock),a.convertThumbnails&&b.push("--convert-thumbnails",a.convertThumbnails),a.writeLink&&b.push("--write-link"),a.writeUrlLink&&b.push("--write-url-link"),a.writeWeblocLink&&b.push("--write-webloc-link"),a.writeLnkLink&&b.push("--write-lnk-link"),a.userAgent&&b.push("--user-agent",a.userAgent),a.extractAudio&&b.push("--extract-audio"),a.audioFormat&&b.push("--audio-format",a.audioFormat),a.audioQuality&&b.push("--audio-quality",a.audioQuality),a.remuxVideo&&b.push("--remux-video",a.remuxVideo),a.recodeVideo&&b.push("--recode-video",a.recodeVideo),a.postprocessorArgs)for(let[c,d]of Object.entries(a.postprocessorArgs))b.push("--postprocessor-args",`${c}:${d.join(" ")}`);if(a.keepVideo&&b.push("--keep-video"),a.noKeepVideo&&b.push("--no-keep-video"),a.postOverwrites&&b.push("--post-overwrites"),a.noPostOverwrites&&b.push("--no-post-overwrites"),a.embedSubs&&b.push("--embed-subs"),a.noEmbedSubs&&b.push("--no-embed-subs"),a.embedThumbnail&&b.push("--embed-thumbnail"),a.noEmbedThumbnail&&b.push("--no-embed-thumbnail"),a.embedMetadata&&b.push("--embed-metadata"),a.noEmbedMetadata&&b.push("--no-embed-metadata"),a.embedChapters&&b.push("--embed-chapters"),a.noEmbedChapters&&b.push("--no-embed-chapters"),a.embedInfoJson&&b.push("--embed-info-json"),a.noEmbedInfoJson&&b.push("--no-embed-info-json"),a.parseMetadata)for(let[c,d]of Object.entries(a.parseMetadata))b.push("--parse-metadata",`${c}:${d}`);if(a.replaceInMetadata)for(let[c,[d,e]]of Object.entries(a.replaceInMetadata))b.push("--replace-in-metadata",`${c} ${d} ${e}`);if(a.xattrs&&b.push("--xattrs"),a.concatPlaylist&&b.push("--concat-playlist",a.concatPlaylist),a.fixup&&b.push("--fixup",a.fixup),a.ffmpegLocation&&b.push("--ffmpeg-location",a.ffmpegLocation),a.exec&&b.push("--exec",a.exec),a.noExec&&b.push("--no-exec"),a.convertSubs&&b.push("--convert-subs",a.convertSubs),a.convertThumbnails&&b.push("--convert-thumbnails",a.convertThumbnails),a.splitChapters&&b.push("--split-chapters"),a.noSplitChapters&&b.push("--no-split-chapters"),a.removeChapters&&b.push("--remove-chapters",a.removeChapters),a.noRemoveChapters&&b.push("--no-remove-chapters"),a.forceKeyframesAtCuts&&b.push("--force-keyframes-at-cuts"),a.noForceKeyframesAtCuts&&b.push("--no-force-keyframes-at-cuts"),a.usePostProcessor&&a.usePostProcessor.length>0)for(let c of a.usePostProcessor)b.push("--use-postprocessor",c);return a.sponsorblockMark&&a.sponsorblockMark.length>0&&b.push("--sponsorblock-mark",a.sponsorblockMark.join(",")),a.sponsorblockRemove&&a.sponsorblockRemove.length>0&&b.push("--sponsorblock-remove",a.sponsorblockRemove.join(",")),a.sponsorblockChapterTitle&&b.push("--sponsorblock-chapter-title",a.sponsorblockChapterTitle),a.noSponsorblock&&b.push("--no-sponsorblock"),a.sponsorblockApi&&b.push("--sponsorblock-api",a.sponsorblockApi),a.additionalOptions&&a.additionalOptions.length>0&&b.push(...a.additionalOptions),b}function p(a){let b=[];for(let c of a.split(`
`).slice(1)){let a=c.match(/(\d+)\s+(\S+)\s+(\S+)\s+(https:\/\/[\S]+)/);a&&b.push({id:parseInt(a[1],10),width:"unknown"===a[2]?"unknown":parseInt(a[2],10),height:"unknown"===a[3]?"unknown":parseInt(a[3],10),url:a[4]})}return b}var q={"2160p":"bv*[height<=2160]","1440p":"bv*[height<=1440]","1080p":"bv*[height<=1080]","720p":"bv*[height<=720]","480p":"bv*[height<=480]","360p":"bv*[height<=360]","240p":"bv*[height<=240]","144p":"bv*[height<=133]",highest:"bv*",lowest:"wv*"};function r(a){if(!a)return[];if("string"==typeof a)return["-f",a];if(0===Object.keys(a).length)return["-f","bv*+ba"];let b=[],{filter:c,quality:d,type:e}=a;return"audioonly"===c&&(b=["-x","--audio-format",e||"mp3","--audio-quality",d?d.toString():"5"]),"videoonly"===c&&(b=["-f",(d?q[d]:"bv*")+"[acodec=none]"]),"audioandvideo"===c&&(b=["-f",("lowest"==d?"w*":"b*")+"[vcodec!=none][acodec!=none][ext="+(e||"mp4")+"]"]),"mergevideo"===c&&(b=["-f",`${d?q[d]:"bv*"}+ba`],e&&b.push("--merge-output-format",e)),b}function s(a){if(!a||"string"==typeof a)return"video/mp4";let{filter:b,type:c}=a;switch(b){case"videoonly":case"audioandvideo":switch(c){case"mp4":default:return"video/mp4";case"webm":return"video/webm"}case"audioonly":switch(c){case"aac":return"audio/aac";case"flac":return"audio/flac";case"mp3":return"audio/mp3";case"m4a":case"alac":return"audio/mp4";case"opus":return"audio/opus";case"vorbis":return"audio/vorbis";case"wav":return"audio/wav";default:return"audio/mpeg"}case"mergevideo":switch(c){case"webm":return"video/webm";case"mkv":return"video/x-matroska";case"ogg":return"video/ogg";case"flv":return"video/x-flv";default:return"video/mp4"}}}function t(a){if(!a||"string"==typeof a)return"mp4";let{filter:b,type:c}=a;return c||("audioonly"===b?"mp3":"mp4")}var u='bright-{"status":"%(progress.status)s","downloaded":"%(progress.downloaded_bytes)s","total":"%(progress.total_bytes)s","total_estimate":"%(progress.total_bytes_estimate)s","speed":"%(progress.speed)s","eta":"%(progress.eta)s"}';function v(a,b=2){let c=Number(a);if(0===c||isNaN(c))return c+" Bytes";let d=Math.floor(Math.log(c)/Math.log(1024));return parseFloat((c/Math.pow(1024,d)).toFixed(b<0?0:b))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][d]}function w(a,b){return Math.round(100*Number(a)/Number(b)*100)/100}function x(a){try{var b;let c,d,e;if(!a.includes("bright"))throw Error();let f=a.split("\r")?.[1]?.trim()?.split("-")?.[1];if(!f)throw Error();let g=JSON.parse(f),h=isNaN(Number(g.total))?Number(g.total_estimate):Number(g.total);return{status:g.status,downloaded:Number(g.downloaded),downloaded_str:v(g.downloaded),total:h,total_str:v(h),speed:Number(g.speed),speed_str:v(g.speed)+"/s",eta:Number(g.eta),eta_str:(b=g.eta,c=Math.floor((b=Number(b))/3600),d=Math.floor(b%3600/60),e=Math.floor(b%3600%60),(c>0?c+(1==c?" hour, ":" hours, "):"")+(d>0?d+(1==d?" minute, ":" minutes, "):"")+(e>=0?e+(1==e?" second":" seconds"):"")),percentage:w(g.downloaded,h),percentage_str:w(g.downloaded,h)+"%"}}catch{return}}async function y(a,b){try{let g=i.createWriteStream(b),h=await function a(b,g={}){return new Promise((h,i)=>{let j=("https:"===new f.URL(b).protocol?d||(d=c.t(l,2)):e||(e=c.t(m,2))).get(b,g,c=>{if(c.statusCode>=300&&c.statusCode<400&&c.headers.location)return void a(new f.URL(c.headers.location,b).toString(),g).then(h).catch(i);h(c)});j.on("error",i),j.setTimeout(3e4,()=>{j.destroy(),i(Error("Request timed out"))})})}(a);if(200!==h.statusCode)throw g.close(),i.unlinkSync(b),Error(`Failed to download file: ${h.statusCode} ${h.statusMessage}`);let j=parseInt(h.headers["content-length"]||"0",10),k=0;return h.on("data",a=>{let b=(k+=a.length)/j*100;process.stdout.write(`Progress: ${Math.round(b)}%\r`)}),h.pipe(g),new Promise((a,c)=>{g.on("finish",()=>{g.close(),console.log(`
Download complete!`),a()}),g.on("error",a=>{g.close(),i.unlinkSync(b),c(a)}),h.on("error",a=>{g.close(),i.unlinkSync(b),c(a)})})}catch(a){throw i.existsSync(b)&&i.unlinkSync(b),a}}var z={win32:{x64:["win-x64-ffmpeg.exe","win-x64-ffprobe.exe"],ia32:["win-ia32-ffmpeg.exe","win-ia32-ffprobe.exe"],arm64:["win-arm64-ffmpeg.exe","win-arm64-ffprobe.exe"]},linux:{x64:["linux-x64-ffmpeg","linux-x64-ffprobe"],arm64:["linux-arm64-ffmpeg","linux-arm64-ffprobe"]},darwin:{x64:["macos-x64-ffmpeg","macos-x64-ffprobe"],arm64:["macos-arm64-ffmpeg","macos-arm64-ffprobe"]},android:{arm64:["linux-arm64-ffmpeg","linux-arm64-ffprobe"]}};function A(){let a=process.platform,b=process.arch;if(!z[a]||!z[a][b])throw Error(`No FFmpeg build available for platform: ${a}, architecture: ${b}`);return z[a][b]}async function B(a){let b=a||G,c=C();if(c)return c;try{let a=A();if(!a.length)throw Error();let c=a.map(a=>`https://github.com/iqbal-rashed/ytdlp-nodejs/releases/download/ffmpeg-latest/${a}`),d=a.map(a=>g.join(b,String(a.split("-").pop())));i.existsSync(b)||i.mkdirSync(b,{recursive:!0}),console.log("Downloading FFmpeg and FFprobe...");for(let b=0;b<a.length;b++){let a=c[b],e=d[b];console.log("Downloading...",g.basename(a)),await y(a,e)}try{for(let a of d)i.chmodSync(a,493)}catch{console.log("Note: Could not set executable permissions (likely Windows)")}return C()}catch(a){throw console.error(`Download failed: ${a}`),a}}function C(){try{let a=A();if(!a.length)throw Error();let b=g.join(G,String(a[0].split("-").pop()));if(!i.existsSync(b))throw Error("FFmpeg binary not found. Please download it first.");return b}catch{return}}var D={win32:{x64:"yt-dlp.exe",ia32:"yt-dlp_x86.exe"},linux:{x64:"yt-dlp",armv7l:"yt-dlp_linux_armv7l",aarch64:"yt-dlp_linux_aarch64",arm64:"yt-dlp"},darwin:{x64:"yt-dlp_macos",arm64:"yt-dlp_macos"},android:{arm64:"yt-dlp"}};async function E(a){let b=a||G,c=function(){let a=process.platform,b=process.arch;if(!D[a]||!D[a][b])throw Error(`No FFmpeg build available for ${a} ${b}`);return D[a][b]}(),d=`https://github.com/yt-dlp/yt-dlp/releases/latest/download/${c}`,e=g.join(b,c);if(i.existsSync(e))return e;console.log("Downloading yt-dlp...",d),i.existsSync(b)||i.mkdirSync(b,{recursive:!0});try{await y(d,e),console.log(`yt-dlp downloaded successfully to: ${e}`);try{i.chmodSync(e,493)}catch{console.log("Error while chmod")}return e}catch(a){throw console.error(`Download failed: ${a}`),a}}function F(){let a=process.platform,b=process.arch;try{let c=D[a][b],d=g.join(G,c);if(!i.existsSync(d))throw Error("Ytdlp binary not found. Please download it first.");return d}catch{return}}var G=g.join(n,"..","bin"),H=class{constructor(a){if(this.binaryPath=a?.binaryPath||F()||"",this.ffmpegPath=a?.ffmpegPath||C(),this.binaryPath&&i.existsSync(this.binaryPath)||console.error(Error("yt-dlp binary not found. Please install yt-dlp or specify correct binaryPath in options.")),this.ffmpegPath&&!i.existsSync(this.ffmpegPath)&&console.error(Error(`FFmpeg binary not found at: ${this.ffmpegPath}. Please install FFmpeg or specify correct ffmpegPath.`)),"win32"!==process.platform)try{i.chmodSync(this.binaryPath,493)}catch(a){console.error(Error(`Failed to set executable permissions: ${a instanceof Error?a.message:"Unknown error"}`))}}async checkInstallationAsync(a){return new Promise((b,c)=>{if(a?.ffmpeg&&!this.ffmpegPath)return c(Error("FFmpeg path is not set"));let d=(0,h.spawn)(this.binaryPath,["--version"]),e=!1,f=!a?.ffmpeg;d.on("error",()=>e=!1),d.on("exit",c=>{if(e=0===c,a?.ffmpeg){let a=(0,h.spawn)(this.ffmpegPath,["-version"]);a.on("error",()=>f=!1),a.on("exit",a=>{f=0===a,b(!!(e&&f))})}else b(!!e)})})}checkInstallation(a){if(a?.ffmpeg&&!this.ffmpegPath)throw Error("FFmpeg path is not set");let b=(0,h.spawnSync)(this.binaryPath,["--version"],{stdio:"ignore"}),c=a?.ffmpeg?(0,h.spawnSync)(this.ffmpegPath,["-version"],{stdio:"ignore"}):{status:0};return 0===b.status&&0===c.status}async execAsync(a,b){let c=this.buildArgs(a,b||{});return this._executeAsync(c,a=>{if(b?.onData?.(a),b?.onProgress){let c=x(a);c&&b.onProgress?.(c)}})}exec(a,b){let c=this.buildArgs(a,b||{},!0);return this._execute(c)}_execute(a){let b=(0,h.spawn)(this.binaryPath,a);return b.stderr.on("data",a=>{let c=x(Buffer.from(a).toString());c&&b.emit("progress",c)}),b.stdout.on("data",a=>{let c=x(Buffer.from(a).toString());c&&b.emit("progress",c)}),b}async _executeAsync(a,b,c){return new Promise((d,e)=>{this.binaryPath||e(Error("Ytdlp binary not found"));let f=(0,h.spawn)(this.binaryPath,a),g="",i="";f.stdout.on("data",a=>{c||(g+=a.toString(),b?.(Buffer.from(a).toString()))}),f.stderr.on("data",a=>{i+=a.toString(),b?.(Buffer.from(a).toString())}),c&&f.stdout.pipe(c),f.on("close",a=>{0===a?d(g):e(Error(`yt-dlp exited with code ${a}: ${i}`))}),f.on("error",a=>{e(Error(`Failed to start yt-dlp process: ${a.message}`))})})}buildArgs(a,b,c,d){let e=o(b);return this.ffmpegPath&&e.push("--ffmpeg-location",this.ffmpegPath),c&&e.push("--progress-template",u),d&&e.push(...d),e.concat(a)}download(a,b){let{format:c,...d}=b||{},e=this.buildArgs(a,d,!0,r(c));return this._execute(e)}async downloadAsync(a,b){let{format:c,onProgress:d,...e}=b||{},f=this.buildArgs(a,e,!!d,r(c));return this._executeAsync(f,a=>{let b=x(a);b&&d?.(b)})}stream(a,b){let{format:c,onProgress:d,...e}=b||{},f=this.buildArgs(a,e,!!d,[...r(c),"-o","-"]),g=new k.PassThrough;return{promise:this._executeAsync(f,a=>{let b=x(a);b&&d?.(b)},g),pipe:(a,b)=>g.pipe(a,b),pipeAsync:(a,b)=>new Promise((c,d)=>{let e=g.pipe(a,b);a.on("finish",()=>c(e)),a.on("error",d)})}}async getInfoAsync(a,b){let c=["--dump-single-json","--quiet",...o({flatPlaylist:!0,...b}),a];return JSON.parse(await this._executeAsync(c))}async getThumbnailsAsync(a){return p(await this._executeAsync(["--print","thumbnails_table","--print","playlist:thumbnails_table","--quiet",a]))}async getTitleAsync(a){return await this._executeAsync(["--print","title",a])}async downloadFFmpeg(){return B()}async getFileAsync(a,b){let c=await this.getInfoAsync(a),{format:d,filename:e,metadata:f,onProgress:g,...h}=b||{},i=new k.PassThrough,l=[];i.on("data",a=>l.push(Buffer.from(a)));let m=this.buildArgs(a,h,!!g,[...r(d),"-o","-"]);await this._executeAsync(m,a=>{if(g){let b=x(a);b&&g(b)}},i);let n=new j.Blob(l,{type:s(d)}),o={name:e||`${c.title}.${t(d)}`,type:s(d),size:n.size,...f};return new File([Buffer.concat(l)],o.name,{type:o.type})}async getUrlsAsync(a,b){let c=["--print","urls",...o({flatPlaylist:!0,...b}),a];return String(await this._executeAsync(c)).split(`
`)}},I={downloadFFmpeg:B,findFFmpegBinary:C,PROGRESS_STRING:u,getContentType:s,getFileExtension:t,parseFormatOptions:r,stringToProgress:x,createArgs:o,extractThumbnails:p,downloadFile:y,BIN_DIR:G,downloadYtDlp:E,findYtdlpBinary:F}}};