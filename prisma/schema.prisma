generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Stream {
  id         String    @id @default(cuid())
  name       String
  source     String
  query      String
  lastPulled DateTime? @map("last_pulled")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  videos     Video[]

  @@map("streams")
}

model Video {
  id           String   @id @default(cuid())
  title        String
  sourceUrl    String?  @map("source_url")
  thumbnailUrl String   @map("thumbnail_url")
  duration     Int?
  likes        Int      @default(0)
  dislikes     Int      @default(0)
  category     String?
  iframe       String?
  tags         String?
  performers   String?
  quality      String?
  uploader     String?
  publishDate  String?  @map("publish_date")
  views        Int      @default(0)
  streamId     String?  @map("stream_id")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  stream       Stream?  @relation(fields: [streamId], references: [id])

  @@index([createdAt(sort: Desc)])
  @@index([title])
  @@index([category])
  @@index([tags])
  @@index([performers])
  @@index([views(sort: Desc)])
  @@index([likes(sort: Desc)])
  @@index([category, createdAt(sort: Desc)])
  @@index([tags, createdAt(sort: Desc)])
  @@index([performers, createdAt(sort: Desc)])
  @@index([views(sort: Desc), createdAt(sort: Desc)])
  @@index([views], map: "videos_views_random_idx")
  @@index([id], map: "videos_id_random_idx")
  @@map("videos")
}

model UserSettings {
  id                String   @id @default(cuid())
  compressionLevel  String   @default("720p") @map("compression_level")
  bitrate           String   @default("1500k")
  multiViewLayout   Int      @default(4) @map("multi_view_layout")
  autoPullFrequency Int      @default(24) @map("auto_pull_frequency")
  likeThreshold     Int      @default(5) @map("like_threshold")
  dislikeThreshold  Int      @default(3) @map("dislike_threshold")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  @@map("user_settings")
}
